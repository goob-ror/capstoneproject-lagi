<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<title>Peta Posyandu Palaran</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0" />

<link href="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.0/maptiler-sdk.css" rel="stylesheet" />
<script src="https://cdn.maptiler.com/maptiler-sdk-js/v2.0.0/maptiler-sdk.umd.js"></script>

<style>
  body { margin:0; font-family: Arial, sans-serif; }
  #map { width:100%; height:100vh; }
  .posyandu-icon { 
    width: 32px; 
    height: 32px; 
    cursor: pointer;
  }
  .posyandu-icon img {
    width: 100%;
    height: 100%;
    object-fit: contain;
  }
  
  /* Toggle Button Styles */
  .map-toggle {
    position: absolute;
    top: 20px;
    right: 20px;
    z-index: 1000;
    background: white;
    border: none;
    border-radius: 8px;
    padding: 12px 16px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.15);
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: #333;
    transition: all 0.2s ease;
  }
  
  .map-toggle:hover {
    background: #f5f5f5;
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
  }
  
  .map-toggle:active {
    transform: translateY(1px);
  }
  
  .toggle-icon {
    margin-right: 8px;
  }
</style></head>
</head>

<body>
<div id="map"></div>

<!-- Map View Toggle Button -->
<button id="mapToggle" class="map-toggle">
  <span class="toggle-icon">üõ∞Ô∏è</span>
  <span id="toggleText">Satellite View</span>
</button>

<script>
maptilersdk.config.apiKey = "Gn8bP4HVYLkF631ZmH2i";

/* ============================
   INIT MAP
============================ */
const map = new maptilersdk.Map({
  container: "map",
  style: maptilersdk.MapStyle.STREETS,
  center: [117.155, -0.579],
  zoom: 12
});

// Track current map style
let isStreetView = true;

/* ============================
   BOUNDARY KELURAHAN (BORDER ONLY)
============================ */
const kelurahanBoundary = [
  { nama: "Simpang Pasir, Palaran, Samarinda", warna: "#ff9800" },
  { nama: "Rawa Makmur, Palaran, Samarinda", warna: "#00c853" },
  { nama: "Handil Bakti, Palaran, Samarinda", warna: "#2979ff" }
];

async function loadKelurahanBorder(item, index) {
  const url = `https://nominatim.openstreetmap.org/search?format=json&polygon_geojson=1&q=${encodeURIComponent(item.nama)}`;
  const res = await fetch(url);
  const data = await res.json();

  if (!data[0]?.geojson) {
    console.warn("Boundary tidak ditemukan:", item.nama);
    return;
  }

  const sourceId = `kel-${index}`;

  map.addSource(sourceId, {
    type: "geojson",
    data: data[0].geojson
  });

  map.addLayer({
    id: `${sourceId}-border`,
    type: "line",
    source: sourceId,
    paint: {
      "line-color": item.warna,
      "line-width": 3,
      "line-opacity": 0.9
    }
  });
}

/* ============================
   HEALTHCARE ICON IMAGE
============================ */
// Using healthcare.png image for markers

/* ============================
   DATA POSYANDU
============================ */
const posyandu = [
  // Simpang Pasir
  { nama:"Amanah", alamat:"Jl. Bojonegoro RT 25", kel:"Simpang Pasir", coord:[117.146681, -0.565351]},
  { nama:"Anggrek Bulan", alamat:"Jl. Mangkujenang RT 23", kel:"Simpang Pasir", coord:[117.145248, -0.551015]},
  { nama:"Mawar Merah", alamat:"Jl. Solo I RT 18", kel:"Simpang Pasir", coord:[117.148680, -0.557824]},
  { nama:"Sumber Waras", alamat:"Jl. Jakarta RT 02", kel:"Simpang Pasir", coord:[117.136784, -0.579885]},

  // Rawa Makmur (adjusted coordinates based on geographic positioning)
  { nama:"Rukun Makmur", alamat:"Jl. S. Parman RT 12", kel:"Rawa Makmur", coord:[117.175279, -0.564970]},
  { nama:"Melati", alamat:"Jl. Widyagama RT 32", kel:"Rawa Makmur", coord:[117.182570, -0.563761]},
  { nama:"Sehat Ceria", alamat:"Jl. Trikora Gg Angga RT 51", kel:"Rawa Makmur", coord:[117.166423, -0.558798]},
  { nama:"Harmoni", alamat:"Jl. Anjasmoro RT 41", kel:"Rawa Makmur", coord:[117.178011, -0.575533]},
  { nama:"Anggrek Hitam", alamat:"Jl. Telagawangi RT 46", kel:"Rawa Makmur", coord:[117.191016, -0.581421]},
  { nama:"Widuri", alamat:"Jl. Anjasmoro RT 21", kel:"Rawa Makmur", coord:[117.184312, -0.575414]},
  { nama:"Kasih Ibu", alamat:"Jl. Hidayah RT 48", kel:"Rawa Makmur", coord:[117.17698655186281, -0.5811497255464922]},
  { nama:"Wijaya Kusuma", alamat:"Jl. Ampera RT 49", kel:"Rawa Makmur", coord:[117.18388627160375, -0.5737118721940422]},
  { nama:"Nusa Indah", alamat:"Jl. Melati RT 19", kel:"Rawa Makmur", coord:[117.175566, -0.579600]},
  { nama:"Rahmat Jaya", alamat:"Jl. H. Ahmad Beta RT 27", kel:"Rawa Makmur", coord:[117.17696287869687, -0.5643725829780366]},
  { nama:"Kenanga", alamat:"Jl. Parikesit RT 39", kel:"Rawa Makmur", coord:[117.18295997839107, -0.5756546375593208]},
  { nama:"Anggrek Putih", alamat:"Jl. Palaran Indah I RT 11", kel:"Rawa Makmur", coord:[117.17573213774212, -0.5653904769684385]},
  { nama:"Tunas Harapan", alamat:"Jl. Adi Sucipto RT 02", kel:"Rawa Makmur", coord:[117.1589971281467, -0.5693944591253207]},
  { nama:"Cempaka Putih", alamat:"Jl. Cempaka RT 26", kel:"Rawa Makmur", coord:[117.1832089050178, -0.5700783445470121]},
  { nama:"Mekar Harum", alamat:"Jl. Melanti RT 23", kel:"Rawa Makmur", coord:[117.17980591273748, -0.573131005021288]},
  { nama:"Flamboyan", alamat:"Jl. Kamboja RT 35", kel:"Rawa Makmur", coord:[117.18320509862184, -0.5681991293034986]},
  { nama:"Sutra Ungu", alamat:"Jl. HOS Cokroaminoto RT 50", kel:"Rawa Makmur", coord:[117.16973620428017, -0.5681739583918306]},
  { nama:"Sri Rejeki", alamat:"Jl. Mulawarman RT 15", kel:"Rawa Makmur", coord:[117.17498827538056, -0.5727821910050801]},

  // Handil Bakti (adjusted coordinates based on Wikidata reference and geographic positioning)
  { nama:"Kemuning", alamat:"Jl. Melati RT 04", kel:"Handil Bakti", coord:[117.17015540691082, -0.5912818316296586]},
  { nama:"Menuju Sehat", alamat:"Jl. Gotong Royong RT 24", kel:"Handil Bakti", coord:[117.15941336461455, -0.5452789304612686]},
  { nama:"Teratai", alamat:"Jl. Parikesit II RT 09", kel:"Handil Bakti", coord:[117.18203999626131, -0.590147829507715]},
  { nama:"Harapan Sehat", alamat:"Jl. Niaga RT 19", kel:"Handil Bakti", coord:[117.152457, -0.570746]},
  { nama:"Cerah Ceria", alamat:"Jl. Ternak Perum Paris RT 26", kel:"Handil Bakti", coord:[117.14957774027917, -0.5767718665893394]},
  { nama:"Mawar Kuning", alamat:"Jl. Padat Karya RT 32", kel:"Handil Bakti", coord:[117.16248250859795, -0.5569167441709747]},
  { nama:"Cendrawasih", alamat:"Jl. Gotong Royong RT 17", kel:"Handil Bakti", coord:[117.15724060599418, -0.5475253451715931]}
];

/* ============================
   LOAD SEMUA SETELAH MAP SIAP
============================ */
map.on("load", async () => {

  // load border kelurahan
  for (let i = 0; i < kelurahanBoundary.length; i++) {
    await loadKelurahanBorder(kelurahanBoundary[i], i);
  }

  // load marker posyandu with healthcare.png image
  posyandu.forEach(p => {
    const el = document.createElement("div");
    el.className = "posyandu-icon";
    el.innerHTML = '<img src="https://cdn-icons-png.flaticon.com/512/3063/3063822.png" alt="Healthcare">';

    new maptilersdk.Marker(el)
      .setLngLat(p.coord)
      .setPopup(
        new maptilersdk.Popup({ offset: 25 })
          .setHTML(`<strong>${p.nama}</strong><br>${p.alamat}<br><em>${p.kel}</em>`)
      )
      .addTo(map);
  });
});

/* ============================
   MAP TOGGLE FUNCTIONALITY
============================ */
document.getElementById('mapToggle').addEventListener('click', function() {
  const toggleButton = document.getElementById('mapToggle');
  const toggleText = document.getElementById('toggleText');
  const toggleIcon = toggleButton.querySelector('.toggle-icon');
  
  if (isStreetView) {
    // Switch to Satellite view with labels
    map.setStyle(maptilersdk.MapStyle.HYBRID);
    toggleText.textContent = 'Street View';
    toggleIcon.textContent = 'üó∫Ô∏è';
    isStreetView = false;
  } else {
    // Switch back to Street view
    map.setStyle(maptilersdk.MapStyle.STREETS);
    toggleText.textContent = 'Satellite View';
    toggleIcon.textContent = 'üõ∞Ô∏è';
    isStreetView = true;
  }
  
  // Re-add sources and layers after style change
  map.once('styledata', async () => {
    // Re-load kelurahan boundaries
    for (let i = 0; i < kelurahanBoundary.length; i++) {
      await loadKelurahanBorder(kelurahanBoundary[i], i);
    }
    
    // Re-add posyandu markers
    posyandu.forEach(p => {
      const el = document.createElement("div");
      el.className = "posyandu-icon";
      el.innerHTML = '<img src="https://cdn-icons-png.flaticon.com/512/3063/3063822.png" alt="Healthcare">';

      new maptilersdk.Marker(el)
        .setLngLat(p.coord)
        .setPopup(
          new maptilersdk.Popup({ offset: 25 })
            .setHTML(`<strong>${p.nama}</strong><br>${p.alamat}<br><em>${p.kel}</em>`)
        )
        .addTo(map);
    });
  });
});
</script>

</body>
</html>
